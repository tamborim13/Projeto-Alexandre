<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Loja de Produtos</title>
  <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
  <header class="header">
    <h1>üõçÔ∏è Loja de Produtos</h1>
    <button id="btnAdicionar" class="btn btn-primary btn-add">
      ‚ûï Adicionar Produto
    </button>

    <button id="button-home" class="button-home">PAGE</button>
  </header>

  <main class="main-content">
    <% if (produtos.length === 0) { %>
      <div class="empty-state">
        <h2>üì¶ Nenhum produto cadastrado</h2>
        <p>Clique no bot√£o "Adicionar Produto" para come√ßar!</p>
      </div>
    <% } else { %>
      <div class="produtos-grid">
        <% produtos.forEach(produto => { %>
          <div class="card">
            <div class="card-image">
              <% if (produto.imagem) { %>
                <img src="/uploads/<%= produto.imagem %>" alt="<%= produto.nome %>">
              <% } else { %>
                <img src="https://via.placeholder.com/200x180?text=Sem+Imagem" alt="Sem imagem">
              <% } %>
            </div>
            <div class="card-content">
              <h3><%= produto.nome %></h3>
              <p class="price">R$ <%= produto.preco.toFixed(2) %></p>
              <a href="/delete/<%= produto.id %>" class="btn btn-danger" 
                 onclick="return confirm('Tem certeza que deseja excluir este produto?')">
                üóëÔ∏è Excluir
              </a>
            </div>
          </div>
        <% }) %>
      </div>
    <% } %>
  </main>

  <!-- Modal/Popup para adicionar produto -->
  <div id="modalAdicionar" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>‚ûï Adicionar Novo Produto</h2>
        <span class="close">&times;</span>
      </div>
      <form id="formAdicionar" action="/add" method="POST" enctype="multipart/form-data">
        <div class="form-group">
          <label for="nome">Nome do Produto:</label>
          <input type="text" id="nome" name="nome" placeholder="Digite o nome do produto" required>
        </div>
        
        <div class="form-group">
          <label for="preco">Pre√ßo (R$):</label>
          <input type="number" id="preco" name="preco" step="0.01" min="0" placeholder="0.00" required>
        </div>
        
        <div class="form-group">
          <label for="imagem">Imagem do Produto:</label>
          <input type="file" id="imagem" name="imagem" accept="image/*">
          <small>Formatos aceitos: JPG, PNG, GIF, WEBP</small>
        </div>
        
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" id="btnCancelar">Cancelar</button>
          <button type="submit" class="btn btn-success">‚úÖ Adicionar Produto</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // Elementos do DOM
    const modal = document.getElementById('modalAdicionar');
    const btnAdicionar = document.getElementById('btnAdicionar');
    const btnCancelar = document.getElementById('btnCancelar');
    const closeBtn = document.querySelector('.close');
    const form = document.getElementById('formAdicionar');
    const btnHome = document.getElementById('button-home')

    // Abrir modal
    btnAdicionar.onclick = function() {
      modal.style.display = 'block';
      document.body.style.overflow = 'hidden'; // Previne scroll da p√°gina
    }

    // Fechar modal - bot√£o X
    closeBtn.onclick = function() {
      modal.style.display = 'none';
      document.body.style.overflow = 'auto';
      form.reset(); // Limpa o formul√°rio
    }

    // Fechar modal - bot√£o Cancelar
    btnCancelar.onclick = function() {
      modal.style.display = 'none';
      document.body.style.overflow = 'auto';
      form.reset(); // Limpa o formul√°rio
    }

    // Fechar modal clicando fora dele
    window.onclick = function(event) {
      if (event.target === modal) {
        modal.style.display = 'none';
        document.body.style.overflow = 'auto';
        form.reset(); // Limpa o formul√°rio
      }
    }

    // Fechar modal com tecla ESC
    document.addEventListener('keydown', function(event) {
      if (event.key === 'Escape' && modal.style.display === 'block') {
        modal.style.display = 'none';
        document.body.style.overflow = 'auto';
        form.reset(); // Limpa o formul√°rio
      }
    });

    // Valida√ß√£o do formul√°rio
    form.addEventListener('submit', function(event) {
      const nome = document.getElementById('nome').value.trim();
      const preco = document.getElementById('preco').value;
      
      if (!nome) {
        alert('Por favor, digite o nome do produto.');
        event.preventDefault();
        return;
      }
      
      if (!preco || parseFloat(preco) <= 0) {
        alert('Por favor, digite um pre√ßo v√°lido maior que zero.');
        event.preventDefault();
        return;
      }
      
      // Se tudo estiver ok, fecha o modal
      modal.style.display = 'none';
      document.body.style.overflow = 'auto';
    });

    // Preview da imagem selecionada
    document.getElementById('imagem').addEventListener('change', function(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          // Remove preview anterior se existir
          const existingPreview = document.querySelector('.image-preview');
          if (existingPreview) {
            existingPreview.remove();
          }
          
          // Cria novo preview
          const preview = document.createElement('div');
          preview.className = 'image-preview';
          preview.innerHTML = `<img src="${e.target.result}" alt="Preview" style="max-width: 100px; max-height: 100px; border-radius: 8px; margin-top: 10px;">`;
          
          event.target.parentNode.appendChild(preview);
        };
        reader.readAsDataURL(file);
      }
    });

    btnHome.onclick = function() {
      window.location.href = "/pages";
}


  </script>
</body>
</html>